generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// User Model - provided by Supabase

// Chat model - represents a conversation session
model Chat {
  id        String   @id @default(cuid())
  userId    String   @map("user_id") // References Supabase auth.users.id
  title     String?  // Optional title for the chat
  shareId   String?  @unique @map("share_id") // For shareable chat links
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  messages Message[]
  
  // Indexes for better query performance
  @@index([userId]) // For getUserChats() query
  @@index([userId, updatedAt(sort: Desc)]) // For getUserChats() with ordering
  @@index([id, userId]) // For getChatWithMessages() compound lookup
  @@map("chats")
}

// Message model - represents individual messages in a chat
model Message {
  id        String   @id @default(cuid())
  chatId    String   @map("chat_id")
  role      String   // 'user' or 'assistant'
  content   String   // The message content
  model     String?  // Optional: which LLM model was used for assistant messages
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relations
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  
  // Indexes for better query performance
  @@index([chatId]) // For foreign key relationship (may already exist)
  @@index([chatId, createdAt]) // For getChatWithMessages() with message ordering
  @@index([createdAt(sort: Desc)]) // For getting latest messages in getUserChats()
  @@map("messages")
}